# Руководство по использованию Banking ML Server

## Быстрый старт

### 1. Запуск сервера
```bash
# Автоматический запуск (рекомендуется)
./start.sh

# Или вручную
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python app.py
```

### 2. Открытие веб-интерфейса
Перейдите в браузере по адресу: `http://localhost:8080`

## Пошаговое использование

### Шаг 1: Загрузка данных
1. Подготовьте CSV файлы с данными:
   - `clients.csv` - данные клиентов
   - `transactions.csv` - данные транзакций
   - `transfers.csv` - данные переводов

2. В веб-интерфейсе загрузите файлы по очереди:
   - Нажмите "Выберите файл" для каждого типа данных
   - Нажмите соответствующую кнопку "Загрузить"

### Шаг 2: Обработка данных
1. После загрузки всех файлов нажмите "Обработать данные"
2. Дождитесь завершения обработки (появится сообщение об успехе)

### Шаг 3: Получение результатов
1. **Рекомендации**: Нажмите "Получить рекомендации" для просмотра топ-4 продуктов для клиентов
2. **Пуш-уведомления**: Нажмите "Сгенерировать пуш-уведомления" для создания персонализированных сообщений
3. **Экспорт**: Нажмите "Экспортировать в CSV" для скачивания результатов
4. **Статистика**: Нажмите "Получить статистику" для просмотра аналитики

## Формат входных данных

### clients.csv
```csv
client_code,name,status,age,city,avg_monthly_balance_KZT
1,Алия,Премиальный клиент,35,Алматы,5000000
2,Рамазан,Зарплатный клиент,28,Астана,1500000
```

### transactions.csv
```csv
date,category,amount,currency,client_code,product
2024-01-15,Такси,5000,KZT,1,
2024-01-20,Кафе и рестораны,15000,KZT,1,
```

### transfers.csv
```csv
date,type,direction,amount,currency,client_code
2024-01-01,salary_in,in,500000,KZT,1
2024-01-15,p2p_out,out,100000,KZT,1
```

## API Endpoints

### Основные операции
- `GET /` - Веб-интерфейс
- `GET /health` - Проверка состояния сервера
- `POST /upload/clients` - Загрузка данных клиентов
- `POST /upload/transactions` - Загрузка данных транзакций
- `POST /upload/transfers` - Загрузка данных переводов
- `POST /process` - Обработка данных
- `GET /recommendations/<client_code>` - Рекомендации для клиента
- `POST /push-notifications` - Генерация пуш-уведомлений
- `GET /export/csv` - Экспорт результатов
- `GET /stats` - Статистика

### Пример использования API
```bash
# Загрузка данных
curl -X POST -F "file=@clients.csv" http://localhost:8080/upload/clients
curl -X POST -F "file=@transactions.csv" http://localhost:8080/upload/transactions
curl -X POST -F "file=@transfers.csv" http://localhost:8080/upload/transfers

# Обработка
curl -X POST http://localhost:8080/process

# Получение пуш-уведомлений
curl -X POST http://localhost:8080/push-notifications

# Экспорт
curl -X GET http://localhost:8080/export/csv
```

## Банковские продукты

Сервер анализирует следующие продукты:

1. **Депозит Сберегательный** - 0.5% месячных от баланса
2. **Кредит наличными** - 1% от исходящих переводов (если есть кредитная карта)
3. **Карта для путешествий** - 2% от трат на поездки
4. **Карта для геймеров** - 1.5% от онлайн-трат
5. **Карта с кэшбэком на все** - 1% от общих трат
6. **Карта с кэшбэком на топ-3 категории** - 3% от топ-3 категорий
7. **Премиальная карта** - 0.8% от баланса (для премиальных клиентов)
8. **Мультивалютный счет** - 0.1% от баланса (если есть FX операции)
9. **Карта с бесплатными переводами** - 0.2% от исходящих переводов
10. **Ипотека** - 0.3% от входящих переводов

## Выходные данные

Результат работы - CSV файл с колонками:
- `client_code` - Код клиента
- `product` - Рекомендованный продукт
- `push_notification` - Персонализированное пуш-уведомление

## Устранение неполадок

### Сервер не запускается
1. Убедитесь, что Python 3.8+ установлен
2. Проверьте, что все зависимости установлены: `pip install -r requirements.txt`
3. Убедитесь, что порт 5000 свободен

### Ошибки загрузки данных
1. Проверьте формат CSV файлов
2. Убедитесь, что все обязательные колонки присутствуют
3. Проверьте кодировку файлов (должна быть UTF-8)

### Ошибки обработки
1. Убедитесь, что все три файла загружены
2. Проверьте, что данные содержат корректные значения
3. Посмотрите логи сервера для детальной информации

## Тестирование

Запустите тестовый скрипт для проверки работы:
```bash
source venv/bin/activate
python test_server.py
```

Этот скрипт:
- Создает тестовые данные
- Загружает их на сервер
- Обрабатывает данные
- Генерирует рекомендации и пуш-уведомления
- Экспортирует результаты
